function pictureShare(){const e=document.getElementById("captured-image"),t=document.createElement("canvas");t.width=720,t.height=1280;t.getContext("2d").drawImage(e,0,0,t.width,t.height);const n=t.toDataURL("image/png",1),a=atob(n.split(",")[1]),i=n.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(a.length),r=new Uint8Array(o);for(let e=0;e<a.length;e++)r[e]=a.charCodeAt(e);const s=new Blob([o],{type:i});if(navigator.share){const e=new File([s],"high-resolution-image.png",{type:"image/png"});navigator.share({title:"High Resolution Image",text:"Check out this high-resolution image!",files:[e]}).then(()=>console.log("Shared successfully!")).catch(e=>console.error("Error sharing:",e))}}function movieShare(){if(navigator.share){const e=new File([movieBlob],"video.mp4",{type:movieBlob.type});navigator.share({title:"Video Frame",text:"Check out this frame from my video!",files:[e]}).then(()=>console.log("Shared successfully!")).catch(e=>console.error("Error sharing:",e))}else console.error("Web Share API is not supported in this browser.")}let startTime,timerStringDOM,countInterval;function msecToSecString(e){e=Math.floor(e/1e3);const t=e%60,n=Math.floor(e/60);return(n<10?"0":"")+String(n)+":"+(t<10?"0":"")+String(t)}function UpdateTimer(){const e=(new Date).getTime();timerStringDOM.innerHTML=msecToSecString(e-startTime)}function countUp(){timerStringDOM=document.querySelector(".movie-record-cnt"),timerStringDOM.innerHTML="00:00",startTime=(new Date).getTime(),countInterval=setInterval(UpdateTimer,1e3)}function countStop(){clearInterval(countInterval)}function countReset(){clearInterval(countInterval),timerStringDOM&&(timerStringDOM.innerHTML="00:00")}let pressTimer,recordingUITimer,recordingFlg=!1,recordingStartTime=0,mediaRecorder;function captureBtnWrapperEvent(e){const t=document.querySelector(".capture-btn-wrapper");e?t.classList.add("preview"):t.classList.remove("preview")}function captureBtnEvent(e){const t=document.getElementById("capture-btn");e?t.classList.add("now-recording"):t.classList.remove("now-recording")}function imgCaptureBtnEvent(e){const t=document.getElementById("capture-btn");e?t.classList.add("now-capture"):t.classList.remove("now-capture")}function captureBtnInnerEvent(e){const t=document.querySelector(".capture-btn-inner");e?t.classList.add("preview"):t.classList.remove("preview")}function cameraSwitchBtnWrapperEvent(e){const t=document.querySelector(".camera-switcher-btn-wrapper");e?t.classList.add("preview"):t.classList.remove("preview")}function previewBtnWrapperEvent(e){const t=document.querySelector(".pic-preview-btn-wrapper"),n=document.getElementById("pic-preview-back-btn");e?(t.classList.add("preview"),n.classList.add("preview"),"function"==typeof adjustCanvasSize&&adjustCanvasSize()):(t.classList.remove("preview"),n.classList.remove("preview"))}function moviePreviewBtnWrapperEvent(e){const t=document.querySelector(".movie-preview-btn-wrapper"),n=document.getElementById("movie-preview-back-btn");e?(t.classList.add("preview"),n.classList.add("preview"),"function"==typeof adjustCanvasSize&&adjustCanvasSize()):(t.classList.remove("preview"),n.classList.remove("preview"))}function backColorBlack(e){const t=document.querySelector("body");e?t.classList.add("now-review"):t.classList.remove("now-review")}function getOSType(){const e=navigator.userAgent.toLowerCase(),t=navigator.platform.toLowerCase();return/iphone|ipod/.test(e)?"ios":/ipad/.test(e)||"macintel"===t&&navigator.maxTouchPoints>1?"ipados":/android/.test(e)?"android":/win/.test(e)?"windows":/macintosh|mac os x/.test(e)?"macos":"others"}function stopRecording(){window.playRecordStopSound&&window.playRecordStopSound(),mediaRecorder.stop(),countStop(),movieBlob=new Blob(window.recordingChunks,{type:"video/mp4"});const e=window.URL.createObjectURL(movieBlob),t=document.getElementById("video");t.src=e,t.style.display="block",t.autoplay=!0,t.loop=!0,t.muted=!1,t.play().catch(e=>{console.error("Video autoplay failed:",e)}),captureBtnWrapperEvent(!0),moviePreviewBtnWrapperEvent(!0),backColorBlack(!0)}function recordingVideo(){window.playRecordStartSound&&window.playRecordStartSound(),recordingFlg=!0,recordingStartTime=Date.now(),cameraSwitchBtnWrapperEvent(!0);const e=document.querySelector(".capture-btn-inner");e.classList.add("rec-start");const t=document.getElementById("capture-btn");t.classList.add("btn-pressed"),setTimeout(()=>{t.classList.remove("btn-pressed")},300),recordingUITimer=setTimeout(()=>{e.classList.add("now-recording"),document.querySelector(".movie-record-cnt-wrapper").classList.add("now-recording"),countUp()},500);const n=getOSType(),a="ios"===n||"ipados"===n?"video/mp4":"video/webm",i=liveRenderTarget.captureStream(30);mediaRecorder=new MediaRecorder(i,{mimeType:a}),window.recordingChunks=[],mediaRecorder.addEventListener("dataavailable",e=>{window.recordingChunks.push(e.data)}),mediaRecorder.addEventListener("error",e=>{console.error("Recorder error:",e.error)}),mediaRecorder.start(100),document.querySelector("#stop-btn").classList.add("now-recording")}function captureImg(){window.playShutterSound&&window.playShutterSound(),captureBtnEvent(!1),captureBtnInnerEvent(!0),imgCaptureBtnEvent(!0),setTimeout(()=>{captureBtnWrapperEvent(!0),cameraSwitchBtnWrapperEvent(!0);const e=document.getElementById("canvas").toDataURL("image/png"),t=document.getElementById("captured-image");t.src=e,t.classList.add("preview"),previewBtnWrapperEvent(!0),backColorBlack(!0)},500)}function btnDown(){captureBtnEvent(!0),recordingFlg?stopRecording():pressTimer=setTimeout(()=>{recordingVideo()},300)}function btnUp(){clearTimeout(pressTimer);const e=document.querySelector(".capture-btn-inner");if(e.classList.remove("rec-start"),recordingFlg&&Date.now()-recordingStartTime<1e3){clearTimeout(recordingUITimer),mediaRecorder&&"inactive"!==mediaRecorder.state&&mediaRecorder.stop(),countStop(),countReset(),recordingFlg=!1,recordingStartTime=0;const t=document.getElementById("capture-btn");return t.classList.remove("now-recording"),e.classList.remove("now-recording"),e.classList.remove("rec-start"),document.querySelector(".movie-record-cnt-wrapper").classList.remove("now-recording"),document.querySelector("#stop-btn").classList.remove("now-recording"),cameraSwitchBtnWrapperEvent(!1),captureBtnEvent(!1),void captureImg()}recordingFlg?captureBtnEvent(!1):captureImg()}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("capture-btn");e.addEventListener("mousedown",()=>{btnDown()}),e.addEventListener("touchstart",e=>{e.stopPropagation(),btnDown()}),e.addEventListener("mouseup",()=>{btnUp()}),e.addEventListener("touchend",()=>{btnUp()}),document.querySelector(".capture-btn-wrapper").removeEventListener("contextmenu",e=>{e.preventDefault()}),document.getElementById("pic-preview-back-btn").addEventListener("click",()=>{captureBtnWrapperEvent(!1),captureBtnInnerEvent(!1),cameraSwitchBtnWrapperEvent(!1),previewBtnWrapperEvent(!1);const e=document.getElementById("captured-image");e.src="",e.classList.remove("preview"),backColorBlack(!1),imgCaptureBtnEvent(!1),captureBtnEvent(!1)}),document.getElementById("movie-preview-back-btn").addEventListener("click",()=>{captureBtnWrapperEvent(!1),captureBtnInnerEvent(!1),cameraSwitchBtnWrapperEvent(!1),moviePreviewBtnWrapperEvent(!1);const e=document.querySelector(".capture-btn-inner");e.classList.remove("rec-start"),e.classList.remove("now-recording"),captureBtnEvent(!1),document.querySelector("#stop-btn").classList.remove("now-recording"),document.querySelector(".movie-record-cnt-wrapper").classList.remove("now-recording");const t=document.getElementById("video");t.src="",t.style.display="none",recordingFlg=!1,backColorBlack(!1),captureBtnEvent(!1)}),document.getElementById("pic-preview-share-btn").addEventListener("click",()=>{pictureShare()}),document.getElementById("movie-preview-share-btn").addEventListener("click",()=>{movieShare()})});function adjustCanvasSize(){const e=document.getElementById("canvas"),t=window.matchMedia("(orientation: landscape)").matches,n=document.querySelector(".camera-switcher-btn-wrapper"),a=document.getElementById("capture-btn"),i=document.getElementById("stop-btn"),o=document.getElementById("pic-preview-share-btn"),r=document.getElementById("movie-preview-share-btn"),s=document.querySelector(".movie-record-cnt");t?(e.style.aspectRatio="initial",n.style.transform="scale(0.6)",a.style.width="100px",a.style.height="100px",i.style.width="100px",i.style.height="100px",o.style.fontSize="24px",o.style.padding="15px 40px",r.style.fontSize="24px",r.style.padding="15px 40px",s.style.fontSize="14px"):(e.style.width="auto",e.style.height="95vh",n.style.transform="scale(1.25)",a.style.width="220px",a.style.height="220px",i.style.width="220px",i.style.height="220px",o.style.fontSize="48px",o.style.padding="35px 60px",r.style.fontSize="48px",r.style.padding="35px 60px",s.style.fontSize="36px")}adjustCanvasSize(),window.addEventListener("resize",adjustCanvasSize),window.addEventListener("orientationchange",adjustCanvasSize);
